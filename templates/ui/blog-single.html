{% extends 'ui/base.html' %}
{% load static %}

{% block title %}
  Blog Single | Lawmaker
{% endblock %}

{% block content %}
<aside id="ftco-hero" class="js-fullheight">
    <div class="flexslider js-fullheight">
        <ul class="slides">
            {% if post.image %}
            <li style="background-image: url('{{ post.image.url }}');">
            {% else %}
            <li style="background-image: url('{% static "images/hero_3.jpg" %}');">
            {% endif %}
                <div class="overlay-gradient"></div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-8 col-md-offset-2 text-center js-fullheight slider-text">
                            <div class="slider-text-inner">
                                <h1><strong>{{ post.title }}</strong></h1>
                                <h2>{{ post.created_at|date:"F d, Y" }}</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</aside>

<div id="ftco-blog">
  <div class="container">
    <div class="row">
      <!-- Main Content -->
      <div class="col-md-8 blog-content">
        <p class="lead">{{ post.content }}</p>

        <!-- Related Blogs -->
        {% if related_blogs %}
        <div class="mt-5">
          <h3 class="mb-4">Related Blogs</h3>
          <div class="row">
            {% for blog in related_blogs %}
              <div class="col-md-4 text-center animate-box mb-3">
                <div class="services p-3 shadow-sm rounded-4">
                  {% if blog.image %}
                    <img src="{{ blog.image.url }}" class="img-fluid rounded mb-2" style="height:150px; object-fit:cover;">
                  {% else %}
                    <img src="{% static 'images/blog_placeholder.jpg' %}" class="img-fluid rounded mb-2" style="height:150px; object-fit:cover;">
                  {% endif %}
                  <h4><a href="{% url 'blog_single' blog.id %}">{{ blog.title|truncatewords:8 }}</a></h4>
                  
                  <a href="{% url 'blog_single' blog.id %}" class="btn btn-sm btn-primary mt-1">Read More</a>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Comments Section -->
        <div class="pt-5">
          <h3 class="mb-5">{{ comments.count }} Comment{{ comments.count|pluralize }}</h3>
          <ul class="comment-list">
            {% for comment in comments %}
              <li class="comment">
                <div class="vcard bio">
                  <img src="{% static 'images/person_2.jpg' %}" alt="Image">
                </div>
                <div class="comment-body">
                  <h3>{{ comment.name }}</h3>
                  <div class="meta">{{ comment.created_at|date:"F d, Y \a\t h:i A" }}</div>
                  <p>{{ comment.message }}</p>
                </div>
              </li>
            {% empty %}
              <p>No comments yet. Be the first to comment!</p>
            {% endfor %}
          </ul>
        </div>

        <!-- Comment Form -->
        <div class="comment-form-wrap pt-5">
          <h3 class="mb-5">Leave a comment</h3>
          <form method="POST" class="">
            {% csrf_token %}
            <div class="form-group">
              <label for="name">Name *</label>
              <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <div class="form-group">
              <label for="email">Email *</label>
              <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="form-group">
              <label for="message">Message</label>
              <textarea id="message" name="message" cols="30" rows="5" class="form-control" required></textarea>
            </div>
            <div class="form-group">
              <input type="submit" value="Post Comment" class="btn btn-primary btn-md text-white">
            </div>
          </form>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="col-md-4 sidebar">
        <!-- Author Info -->
        <div class="sidebar-box mb-4">
          {% if post.author.profile_image %}
            <p><img src="{{ post.author.profile_image.url }}" alt="{{ post.author.name }}" class="img-responsive img-rounded"></p>
          {% else %}
            <p><img src="{% static 'images/default-author.jpg' %}" alt="{{ post.author.name }}" class="img-responsive img-rounded"></p>
          {% endif %}
          <h3 class="text-black">About {{ post.author.name }}</h3>
          <p>{{ post.author.bio|default:"No biography available for this author." }}</p>
        </div>

        <!-- Recent Blogs -->
        <div class="sidebar-box">
          <h3>Recent Blogs</h3>
          {% for recent in recent_blogs %}
            <div class="recent-blog-item mb-3">
              <h5><a href="{% url 'blog_single' recent.id %}">{{ recent.title|truncatewords:6 }}</a></h5>
              <span class="text-muted" style="font-size: 13px;">{{ recent.created_at|date:"F d, Y" }}</span>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
